; Install Workbench Adf Script
; ----------------------------
;
; Date: 2016-12-13
; Author: Henrik Noerfjand Stengaard


; Clear screen
echo "*ec" 

SKIP findworkbenchadf

; Load library for UnADF
echo "Load library for UnADF"
echo "----------------------"
echo ""

; Load mathieeedoubbas.library for unadf, if not loaded
loadmodule list >RAM:moduleslist
search RAM:moduleslist "mathieeedoubbas.library" >NIL:

; Goto findworkbenchadf, if mathieeedoubbas.library is loaded
IF NOT WARN
  echo "The library mathieeedoubbas.library is loaded."
  SKIP findworkbenchadf
ENDIF

; Copy mathieeedoubbas.library
copy DF0:Libs/mathieeedoubbas.library SYS:Libs

; Load library description
echo "The library mathieeedoubbas.library must be loaded for"
echo "for UnAdf. It will restart the system and Workbench 3.1"
echo "disk must be ejected before restarting."

; Print eject disk
LAB ejectdisk
echo ""
echo "Eject disk from DF0:"
ask "Press ENTER to continue"

; Check if disk is present in DF0, if present go back to eject disk
DiskInDrive DF0:
IF NOT WARN
  echo ""
  echo "Disk is inserted in DF0:!"
  SKIP ejectdisk back
ENDIF


; Load mathieeedoubbas.library
LoadModule SYS:Libs/mathieeedoubbas.library

; Find Workbench adf files
LAB findworkbenchadf
echo ""
echo "Find Workbench adf files"
echo "------------------------"
echo ""
echo "Finding Workbench adf files in WORKBENCHDIR:..."
fsearch WORKBENCHDIR:#?.adf >T:workbench-adf-files1
sed "s/^\(.\)/execute *"SYSTEMDIR:HstWBInstaller\/Copy-Workbench-Adf*" *"\1/" T:workbench-adf-files1 >T:workbench-adf-files2
sed "s/\(.\)$/\1*" *"SYSTEMDIR:HstWBInstaller\/Workbench\/*"/" T:workbench-adf-files2 >T:workbench-adf-files3
execute T:workbench-adf-files3


; Fail, if workbench adf files doesn't exist
IF NOT EXISTS "SYSTEMDIR:HstWBInstaller/Workbench/workbench31workbench.adf"
  ECHO "Workbench 3.1 Workbench adf doesn't exist!"
  SKIP fail
ENDIF
IF NOT EXISTS "SYSTEMDIR:HstWBInstaller/Workbench/workbench31locale.adf"
  ECHO "Workbench 3.1 Locale adf doesn't exist!"
  SKIP fail
ENDIF
IF NOT EXISTS "SYSTEMDIR:HstWBInstaller/Workbench/workbench31extras.adf"
  ECHO "Workbench 3.1 Extras adf doesn't exist!"
  SKIP fail
ENDIF
IF NOT EXISTS "SYSTEMDIR:HstWBInstaller/Workbench/workbench31fonts.adf"
  ECHO "Workbench 3.1 Fonts adf doesn't exist!"
  SKIP fail
ENDIF
IF NOT EXISTS "SYSTEMDIR:HstWBInstaller/Workbench/workbench31install.adf"
  ECHO "Workbench 3.1 Install adf doesn't exist!"
  SKIP fail
ENDIF
IF NOT EXISTS "SYSTEMDIR:HstWBInstaller/Workbench/workbench31storage.adf"
  ECHO "Workbench 3.1 Storage adf doesn't exist!"
  SKIP fail
ENDIF

echo "Done."


; Workbench installation
echo ""
echo "Workbench Installation from adf"
echo "-------------------------------"
echo ""



; Install Workbench 3.1 Workbench adf
echo "Installing Workbench 3.1 Workbench files..."
;unadf >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31workbench.adf" DEST=SYSTEMDIR:HstWBInstaller/Workbench
;copy >NIL: SYSTEMDIR:HstWBInstaller/Workbench/Workbench3.1 SYSTEMDIR: ALL CLONE

diskwiz >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31workbench.adf" ff0:
copy >NIL: ff0: SYSTEMDIR: ALL CLONE


; Install Workbench 3.1 Locale adf
echo "Installing Workbench 3.1 Locale files..."
;unadf >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31locale.adf" DEST=SYSTEMDIR:HstWBInstaller/Workbench
;makedir >NIL: SYSTEMDIR:Locale
;copy >NIL: SYSTEMDIR:HstWBInstaller/Workbench/Locale SYSTEMDIR:Locale ALL CLONE

diskwiz >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31locale.adf" ff0:
makedir >NIL: SYSTEMDIR:Locale
copy >NIL: ff0: SYSTEMDIR:Locale ALL CLONE


; Install Workbench 3.1 Extras adf
echo "Installing Workbench 3.1 Extras files..."
;unadf >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31extras.adf" DEST=SYSTEMDIR:HstWBInstaller/Workbench
;copy >NIL: SYSTEMDIR:HstWBInstaller/Workbench/Extras3.1 SYSTEMDIR: ALL CLONE

diskwiz >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31extras.adf" ff0:
copy >NIL: ff0: SYSTEMDIR: ALL CLONE


; Install Workbench 3.1 Fonts adf
echo "Installing Workbench 3.1 Fonts files..."
;unadf >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31fonts.adf" DEST=SYSTEMDIR:HstWBInstaller/Workbench
;makedir >NIL: SYSTEMDIR:Fonts
;copy >NIL: SYSTEMDIR:HstWBInstaller/Workbench/Fonts SYSTEMDIR:Fonts ALL CLONE

diskwiz >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31fonts.adf" ff0:
makedir >NIL: SYSTEMDIR:Fonts
copy >NIL: ff0: SYSTEMDIR:Fonts ALL CLONE


; Install Workbench 3.1 Install adf
echo "Installing Workbench 3.1 Install files..."
;unadf >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31install.adf" DEST=SYSTEMDIR:HstWBInstaller/Workbench
;makedir >NIL: SYSTEMDIR:Tools
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/BRU SYSTEMDIR:Tools CLONE
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/HDBackup SYSTEMDIR:Tools CLONE
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/HDBackup.help SYSTEMDIR:Tools CLONE
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/HDToolBox SYSTEMDIR:Tools CLONE

;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/HDBackup.info SYSTEMDIR:Tools CLONE
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/HDToolBox.info SYSTEMDIR:Tools CLONE

;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/S/BRUtab SYSTEMDIR:S CLONE
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/HDTools/S/HDBackup.config SYSTEMDIR:S CLONE 
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/L/FastFileSystem SYSTEMDIR:L CLONE 

;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/Libs/68040.library SYSTEMDIR:Libs CLONE 
;copy SYSTEMDIR:HstWBInstaller/Workbench/Install3.1/Update/Disk.info SYSTEMDIR: CLONE 

diskwiz >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31install.adf" ff0:
makedir >NIL: SYSTEMDIR:Tools
copy ff0:HDTools/BRU SYSTEMDIR:Tools CLONE
copy ff0:HDTools/HDBackup SYSTEMDIR:Tools CLONE
copy ff0:HDTools/HDBackup.help SYSTEMDIR:Tools CLONE
copy ff0:HDTools/HDToolBox SYSTEMDIR:Tools CLONE

copy ff0:HDTools/HDBackup.info SYSTEMDIR:Tools CLONE
copy ff0:HDTools/HDToolBox.info SYSTEMDIR:Tools CLONE

copy ff0:HDTools/S/BRUtab SYSTEMDIR:S CLONE
copy ff0:HDTools/S/HDBackup.config SYSTEMDIR:S CLONE 
copy ff0:L/FastFileSystem SYSTEMDIR:L CLONE 

copy ff0:Libs/68040.library SYSTEMDIR:Libs CLONE 
copy ff0:Update/Disk.info SYSTEMDIR: CLONE 



; Install Workbench 3.1 Storage adf
echo "Installing Workbench 3.1 Storage files..."
;unadf >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31storage.adf" DEST=SYSTEMDIR:HstWBInstaller/Workbench
;makedir >NIL: SYSTEMDIR:Storage
;copy >NIL: SYSTEMDIR:HstWBInstaller/Workbench/Storage3.1 SYSTEMDIR:Storage ALL CLONE
;copy SYSTEMDIR:HstWBInstaller/Workbench/Storage3.1/Monitors/PAL SYSTEMDIR:Devs/Monitors CLONE 
;copy SYSTEMDIR:HstWBInstaller/Workbench/Storage3.1/Monitors/PAL.info SYSTEMDIR:Devs/Monitors CLONE 
;copy SYSTEMDIR:HstWBInstaller/Workbench/Storage3.1/Printers.info SYSTEMDIR:Storage.info CLONE 

diskwiz >NIL: "SYSTEMDIR:HstWBInstaller/Workbench/workbench31storage.adf" ff0:
makedir >NIL: SYSTEMDIR:Storage
copy >NIL: ff0: SYSTEMDIR:Storage ALL CLONE
copy ff0:Monitors/PAL SYSTEMDIR:Devs/Monitors CLONE 
copy ff0:Monitors/PAL.info SYSTEMDIR:Devs/Monitors CLONE 
copy ff0:Printers.info SYSTEMDIR:Storage.info CLONE 


echo "Done."
SKIP end


; Fail
LAB fail
echo ""
echo "Not all Workbench adf files exists. Installation will fallback"
echo "to install Workbench from disks."
echo ""
echo "It's also possible to change directory with Workbench adf files"
echo "and reset to retry installing Workbench from adf files again."
echo ""
ask "Press ENTER to continue"
execute "SYSTEMDIR:HstWBInstaller/Install-Workbench-Disk"


; End
LAB end