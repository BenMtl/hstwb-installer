; Detect Amiga OS 3.9
; -------------------
;
; Date: 2018-11-27
; Author: Henrik Noerfjand Stengaard
;
; AmigaDOS script to detect if Amiga OS 3.9 cd-rom, iso and Boing Bag lha files are present.


; set failat to 255 for DiskInDrive to fail silently
failat 255

; set amigaos39cd to 1, if "CD0:" device exists
set amigaos39cd "0"
DiskInDrive >NIL: CD0:
IF $RC EQ 0 VAL
  set amigaos39cd "1"
ENDIF

; set amigaosdir to 1, if "AMIGAOSDIR:" device exists
set amigaosdir "0"
DiskInDrive >NIL: AMIGAOSDIR:
IF $RC EQ 0 VAL
  set amigaosdir "1"
ENDIF

; set failat to 21
failat 21

IF "$amigaosdir" EQ 1 VAL
  ; find and sort amiga os 3.9 iso files
  echo "" NOLINE >T:_amigaos39isofiles
  fsearch "AMIGAOSDIR:" PAT amigaos39.iso >>T:_amigaos39isofiles1
  fsearch "AMIGAOSDIR:" PAT amigaos3.9.iso >>T:_amigaos39isofiles1
  frsort <T:_amigaos39isofiles1 >T:_amigaos39isofiles

  ; get first amiga os 3.9 iso file
  sed "1q;d" T:_amigaos39isofiles >T:_amigaos39isofile
  set amigaos39isofile "`type T:_amigaos39isofile`"

  ; create amiga os 3.9 iso prefs, if amiga os 3.9 iso file exists
  IF NOT "$amigaos39isofile" EQ ""
    echo "" NOLINE >INSTALLDIR:Prefs/Amiga-OS-390-Iso
  ENDIF

  ; find and sort amiga os 3.9 boing bag files
  fsearch "AMIGAOSDIR:" PAT BoingBag39#?.lha >T:_boingbagfiles1
  frsort <T:_boingbagfiles1 >T:_boingbagfiles

  ; set boing bags
  set boingbags `wc -l <T:_boingbagfiles` 

  ; create amiga os 3.9 iso prefs, if amiga os 3.9 iso file exists
  IF NOT "$boingbags" EQ 0 VAL
    search >NIL: "T:_boingbagfiles" "BoingBag39-1.lha"
    IF $RC EQ 0 VAL
      echo "" NOLINE >INSTALLDIR:Prefs/Amiga-OS-390-BB1
      search >NIL: "T:_boingbagfiles" "BoingBag39-2.lha"
      IF $RC EQ 0 VAL
        echo "" NOLINE >INSTALLDIR:Prefs/Amiga-OS-390-BB2
      ENDIF
    ENDIF
  ENDIF
ENDIF

; goto 
IF "$amigaos39cd" EQ 1
  SKIP amigaos39valid
ENDIF



; amiga os 3.9 iso
; ----------------
LAB amigaos39iso



; amiga os 3.9 valid
; ------------------
LAB amigaos39valid

; goto boingbags, if "AmigaOS3.9:" device doesn't exist
Assign >NIL: EXISTS AmigaOS3.9:
IF NOT $RC EQ 0 VAL
  SKIP boingbags
ENDIF

; goto boingbags, if "AmigaOS3.9:EMERGENCY-BOOT" directory doesn't exist
IF NOT EXISTS AmigaOS3.9:EMERGENCY-BOOT
  SKIP boingbags
ENDIF


; boing bags
; ----------
LAB boingbags
