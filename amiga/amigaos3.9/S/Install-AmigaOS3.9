; Install Amiga OS 3.9 Script
; ---------------------------
;
; Date: 2017-07-10
; Author: Henrik Noerfjand Stengaard
;
; An AmigsDOS script to automate installation of Amiga OS 3.9.


; Clear screen
echo "*ec" 


echo "Amiga OS 3.9 Installation"
echo "-------------------------"


; Goto fail, if device OS39: doesn't exist
Assign >NIL: EXISTS OS39:
IF WARN
  echo ""
  echo "*e[1mERROR: Device OS39: doesn't exist!*e[22m"
  SKIP fail
ENDIF


; Goto fail, if device INSTALL: doesn't exist
Assign >NIL: EXISTS INSTALL:
IF WARN
  echo ""
  echo "*e[1mERROR: Device INSTALL: doesn't exist!*e[22m"
  SKIP fail
ENDIF


; Goto mount amiga os 3.9 iso, if device CD0: doesn't exists
Assign >NIL: EXISTS CD0:
IF WARN
  SKIP mountamigaos39iso
ENDIF


; Set fail at 255 for DiskInDrive to fail properly
failat 255


; Goto mount amiga os 3.9 iso, if device CD0: doesn't contain a cd-rom
DiskInDrive >NIL: CD0:
IF WARN
  ; Set fail at 21
  failat 21

  SKIP mountamigaos39iso
ENDIF


; Set fail at 21
failat 21


; Goto check amiga os 3.9 cd, if CD0:OS-VERSION3.9.INFO exists
IF EXISTS CD0:OS-VERSION3.9.INFO
  SKIP checkamigaos39cd
ENDIF


; Mount FCD0: with Amiga OS 3.9 iso
; ---------------------------------
LAB mountamigaos39iso

echo ""
echo "CD Drive device CD0: not found."
echo ""
echo "Installation process will fallback to mounting"
echo "Amiga OS 3.9 iso as a virtual cd-rom drive."
echo ""
ask "Press ENTER to continue"

echo ""
echo "Mounting Amiga OS 3.9 iso..."
Mount FCD0: FROM INSTALL:Devs/Mountlist
wait 5
echo "Done"


; Goto fail, if device FCD0: doesn't exist
Assign >NIL: EXISTS FCD0:
IF WARN
  echo ""
  echo "*e[1mERROR: Device FCD0: doesn't exist!*e[22m"
  SKIP fail
ENDIF


; Check Amiga OS 3.9 CD
; ---------------------
LAB checkamigaos39cd

; Goto fail, if device AmigaOS3.9: doesn't exist
Assign >NIL: EXISTS AmigaOS3.9:
IF WARN
  echo ""
  echo "*e[1mERROR: Device AmigaOS3.9: doesn't exist!*e[22m"
  SKIP fail
ENDIF


; Goto fail, if AmigaOS3.9:OS-VERSION3.9/Workbench3.5 doesn't exist
IF NOT EXISTS AmigaOS3.9:OS-VERSION3.9/Workbench3.5
  echo ""
  echo "*e[1mERROR: Amiga OS 3.9 CD doesn't contain 'OS-VERSION3.9/Workbench3.5'!*e[22m"
  SKIP fail
ENDIF


; Goto fail, if AmigaOS3.9:OS-VERSION3.9/Workbench3.9 doesn't exist
IF NOT EXISTS AmigaOS3.9:OS-VERSION3.9/Workbench3.9
  echo ""
  echo "*e[1mERROR: Amiga OS 3.9 CD doesn't contain 'OS-VERSION3.9/Workbench3.9'!*e[22m"
  SKIP fail
ENDIF


; Goto fail, if AmigaOS3.9:OS-VERSION3.9/Extras doesn't exist
IF NOT EXISTS AmigaOS3.9:OS-VERSION3.9/Extras
  echo ""
  echo "*e[1mERROR: Amiga OS 3.9 CD doesn't contain 'OS-VERSION3.9/Extras'!*e[22m"
  SKIP fail
ENDIF


; Goto fail, if AmigaOS3.9:EMERGENCY-BOOT doesn't exist
IF NOT EXISTS AmigaOS3.9:EMERGENCY-BOOT
  echo ""
  echo "*e[1mERROR: Amiga OS 3.9 CD doesn't contain 'EMERGENCY-BOOT'!*e[22m"
  SKIP fail
ENDIF


; Goto fail, if AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS doesn't exist
IF NOT EXISTS AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS
  echo ""
  echo "*e[1mERROR: Amiga OS 3.9 CD doesn't contain 'OS-VERSION3.9/INSTALL-TOOLS'!*e[22m"
  SKIP fail
ENDIF


; Copy Workbench 3.9
echo "Copying Workbench..."

Copy >NIL: AmigaOS3.9:OS-VERSION3.9/Workbench3.5 SYSTEMDIR: ALL
Copy >NIL: AmigaOS3.9:OS-VERSION3.9/Workbench3.9 SYSTEMDIR: ALL


; Copy libs
echo "Copying Libs..."

;Copy >NIL: AmigaOS3.9:OS-VERSION3.9/Extras/Libs/mpega.library SYSTEMDIR:Libs
Copy >NIL: AmigaOS3.9:OS-VERSION3.9/Extras/Libs/asyncio.library SYSTEMDIR:Libs


; Copy backdrops (optional)
echo "Copying Backdrops..."

Copy >NIL: AmigaOS3.9:OS-VERSION3.9/Extras/Backdrops SYSTEMDIR:Prefs/Presets/Backdrops ALL


; Copy locale
echo "Copying Locale..."

Copy >NIL: AmigaOS3.9:OS-VERSION3.9/LOCALE SYSTEMDIR:Locale ALL


; Copy keymaps
; ------------

echo "Copying keymaps..."

Copy >NIL: AmigaOS3.9:OS-VERSION3.9/Workbench3.9/Storage/Keymaps SYSTEMDIR:Devs/Keymaps


; Copy 68040.library, if it doesn't exist
;IF NOT EXISTS "SYSTEMDIR:Libs/68040.library"
;  Copy >NIL: "AmigaOS3.9:OS-VERSION3.9/Extras/Libs/68040.library" SYSTEMDIR:Libs
;ENDIF

; Copy 68060.library, if it doesn't exist
;IF NOT EXISTS "SYSTEMDIR:Libs/68060.library"
;  Copy >NIL: "AmigaOS3.9:OS-VERSION3.9/Extras/Libs/68060.library" SYSTEMDIR:Libs
;ENDIF


; Update FastFileSystem
; ---------------------
IF EXISTS "SYSTEMDIR:L/FastFileSystem"
  Version >NIL: "SYSTEMDIR:L/FastFileSystem" 40 FILE
  IF WARN
    Rename >NIL: "SYSTEMDIR:L/FastFileSystem" "SYSTEMDIR:L/FastFileSystem-old"
  ENDIF 
ENDIF 

Copy >NIL: "AmigaOS3.9:OS-VERSION3.9/L/FastFileSystem" "SYSTEMDIR:L"


; Fix fonts
; ---------

echo "Fix fonts..."

Assign >NIL: Fonts: "SYSTEMDIR:Fonts"

SYSTEMDIR:System/FixFonts

Assign >NIL: Fonts: "SYSTEMDIR:Fonts" REMOVE


; Prefs
; -----

Copy >NIL: "AmigaOS3.9:OS-VERSION3.9/EMERGENCY-DISK/PREFS/ENV-ARCHIVE/SYS/FONT.PREFS" "SYSTEMDIR:Prefs/Env-Archive/Sys"
Copy >NIL: "AmigaOS3.9:EMERGENCY-BOOT/PREFS/ENV-ARCHIVE/SYS/REACTION.PREFS" "SYSTEMDIR:Prefs/Env-Archive/Sys"
Copy >NIL: "AmigaOS3.9:EMERGENCY-BOOT/PREFS/ENV-ARCHIVE/SYS/WBCONFIG.PREFS" "SYSTEMDIR:Prefs/Env-Archive/Sys"
Copy >NIL: "AmigaOS3.9:EMERGENCY-BOOT/PREFS/ENV-ARCHIVE/SYS/WBPATTERN.PREFS" "SYSTEMDIR:Prefs/Env-Archive/Sys"
Copy >NIL: "AmigaOS3.9:EMERGENCY-BOOT/PREFS/ENV-ARCHIVE/SYS/WORKBENCH.PREFS" "SYSTEMDIR:Prefs/Env-Archive/Sys"


; Copy uae prefs, if it exists in install
IF EXISTS INSTALL:Prefs/UAE
  Copy >NIL: INSTALL:Prefs/UAE SYSTEMDIR:Prefs
ENDIF


; Cleanup
; -------

echo "Cleaning up..."

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs"   10 220 DXPOS 50 DYPOS 50 DWIDTH 520 DHEIGHT 240
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Font"                       10 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Locale"                     80 10

;      (tooltype (dest (tackon target "Prefs/Locale")) (settooltype "MAP" "PROGDIR:WORLDMAP"))

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Pointer"                   150 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/PrinterPS"                 220 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Sound"                     290 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/ReAction"                  360 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/IControl"                   10 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Overscan"                   80 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Printer"                   150 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/ScreenMode"                220 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Time"                      290 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Workbench"                 360 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Input"                     10 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Palette"                   80 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/PrinterGfx"               150 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Serial"                   220 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/WBPattern"                290 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/Presets"                  430 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Prefs/CacheCDFS"                360 150

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Utilities"      10 80 DXPOS 40 DYPOS 60 DWIDTH 180 DHEIGHT 100
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Utilities/Clock"                  80 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Utilities/MultiView"              10 10

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools"          10 150 DXPOS 20 DYPOS 80 DWIDTH 290 DHEIGHT 300
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities"     10 10 DXPOS 80 DYPOS 60 DWIDTH 240 DHEIGHT 240
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/Exchange"       10 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/Blanker"        10 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/ClickToFront"   80 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/CrossDOS"       80 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/FKey"          150 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/AutoPoint"     10 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/NoCapsLock"    80 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Commodities/MouseBlanker"  150 80

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/EditPad"                   80  10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/IconEdit"                 150  10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/PrepCard"                 220  10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Mounter"                   10  80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/MEmacs"                    80  80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/ShowConfig"               150  80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/CMD"                      220  80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Calculator"                10 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/HDToolBox"                 80 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/KeyShow"                  150 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/Lacer"                    220 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/GraphicDump"               10 220
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/InitPrinter"               80 220
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/PrintFiles"               150 220
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Tools/FindFile"                 220 220

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:System"    10 10 DXPOS 50 DYPOS 60 DWIDTH 240 DHEIGHT 180
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:System/FixFonts"                10 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:System/Format"                  80 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:System/NoFastMem"              150 10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:System/RexxMast"                10 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:System/Shell"                   80 80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:System/Intellifont"            150 80

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Devs"      80 10 DXPOS 80 DYPOS 77 DWIDTH 180 DHEIGHT 230
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Devs/Datatypes"                 10  10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Devs/DosDrivers"                10  80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Devs/KeyMaps"                   80  10
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Devs/Monitors"                  80  80
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Devs/Printers"                 10 150

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Storage"              80  80 DXPOS 480 DYPOS 77 DWIDTH 180 DHEIGHT 230
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Storage/Datatypes"    10  10 DXPOS 480 DYPOS 77 DWIDTH 107 DHEIGHT 199
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Storage/DosDrivers"   10  80 DXPOS 480 DYPOS 77 DWIDTH 107 DHEIGHT 199
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Storage/KeyMaps"      80  10 DXPOS 480 DYPOS 77 DWIDTH 107 DHEIGHT 199
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Storage/Monitors"     80  80 DXPOS 480 DYPOS 77 DWIDTH 107 DHEIGHT 199
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Storage/Printers"     10 150 DXPOS 480 DYPOS 77 DWIDTH 107 DHEIGHT 199

AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:WBStartup" 80 220
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Expansion" 80 150
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Trashcan" 160 220
AmigaOS3.9:OS-VERSION3.9/INSTALL-TOOLS/ICONPOS >NIL: "SYSTEMDIR:Disk"      DXPOS 50 DYPOS 50 DWIDTH 250 DHEIGHT 310


; Done message
echo "Done"
echo ""
echo "Amiga OS 3.9 installation is complete."


; Copy default 640 x 512 display mode screenmode prefs
Copy >NIL: INSTALL:Install-AmigaOS3.9/Prefs/Env-Archive/Sys/screenmode.prefs SYSTEMDIR:Prefs/Env-Archive/Sys


; Copy c, reqtools library and prefs
Copy >NIL: INSTALL:C SYSTEMDIR:C ALL
Copy >NIL: INSTALL:Libs/reqtools.library SYS:Libs
Copy >NIL: INSTALL:Prefs/Env-Archive/ReqTools.prefs SYS:Prefs/Env-Archive


; Copy install packages to systemdir, if install packages prefs exists
IF EXISTS INSTALL:Prefs/Install-Packages
  Copy >NIL: INSTALL:S/Assign-HstWB-Installer SYSTEMDIR:S
  Copy >NIL: INSTALL:Prefs/Install-Packages SYSTEMDIR:Prefs
  Copy >NIL: INSTALL:S/Install-Packages SYSTEMDIR:S
ENDIF


; Create install boing bags prefs and copy install amiga os 3.9 to systemdir, if boing bag 1 exist
IF EXISTS INSTALL:Prefs/Install-BoingBags
  Copy >NIL: INSTALL:S/Assign-HstWB-Installer SYSTEMDIR:S
  Copy >NIL: INSTALL:Prefs/Install-BoingBags SYSTEMDIR:Prefs
  Copy >NIL: INSTALL:Install-AmigaOS3.9 SYSTEMDIR: ALL
ENDIF

SKIP end


; Fail
; ----
LAB fail

echo ""
echo "Amiga OS 3.9 installation failed and has stopped"
echo "installation process."
echo ""
echo "Try to resolve error, if possible then restart to"
echo "rerun installation process."
echo ""
quit


; End
; ---
LAB end

echo ""
ask "Press ENTER to continue"