.KEY disk/a
.BRA {
.KET }

; Disk Template
; -------------
;
; Date: 2018-12-07
; Author: Henrik Noerfjand Stengaard
;
; AmigaDOS script to template to install amiga os 3.1 from floppy disk
; "disk" argument defines amiga os 3.1 disk to install.


; quit, if detect disk doesn't exist
IF NOT EXISTS "INSTALLDIR:S/Amiga-OS-3.1/Detect-{disk}"
  echo "*e[1mError: Detect Amiga OS 3.1 {disk} doesn't exist!*e[0m"
  quit 20
ENDIF

; quit, if install disk doesn't exist
IF NOT EXISTS "INSTALLDIR:S/Amiga-OS-3.1/Install-{disk}"
  echo "*e[1mError: Install Amiga OS 3.1 {disk} doesn't exist!*e[0m"
  quit 20
ENDIF


; insert disk
; -----------
LAB insertdisk
echo ""
echo "Please insert Amiga OS 3.1 {disk} disk in any"
echo "floppy device."
echo ""
ask "Press ENTER to continue"
echo ""

; set failat 255 for diskindrive to fail silently
failat 255

; goto detect disk, if disk is present in DF0: device
DiskInDrive >NIL: DF0:
IF $RC EQ 0 VAL
  set amigaosdisk "DF0"
  SKIP detectdisk
ENDIF

; goto detect disk, if disk is present in DF1: device
DiskInDrive >NIL: DF1:
IF $RC EQ 0 VAL
  set amigaosdisk "DF1"
  SKIP detectdisk
ENDIF

; goto detect disk, if disk is present in DF2: device
DiskInDrive >NIL: DF2:
IF $RC EQ 0 VAL
  set amigaosdisk "DF2"
  SKIP detectdisk
ENDIF

; goto insert disk, if disk not is present in DF3: device
DiskInDrive >NIL: DF3:
IF NOT $RC EQ 0 VAL
  echo "No disk is inserted in any floppy device!"
  SKIP BACK insertdisk
ENDIF

; set amigaosdisk to df3: floppy device
set amigaosdisk "DF3"


; detect disk
; -----------
LAB detectdisk

; set failat to 21
failat 21

; run detect amiga os 3.1 disk
Execute "INSTALLDIR:S/Amiga-OS-3.1/Detect-{disk}"

; goto insert disk, if disk is not valid
IF NOT "$diskvalid" EQ 1 VAL
  echo "Amiga OS 3.1 {disk} disk in $amigaosdisk: floppy device"
  echo "is not valid!"
  SKIP BACK insertdisk
ENDIF

; run install amiga os 3.1 disk
echo "Installing from Amiga OS 3.1 {disk}..."
Execute "INSTALLDIR:S/Amiga-OS-3.1/Install-{disk}"
echo "Done"
