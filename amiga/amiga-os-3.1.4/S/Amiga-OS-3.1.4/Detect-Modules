; Detect Amiga OS 3.1.4 Modules
; -----------------------------
;
; Date: 2018-12-06
; Author: Henrik Noerfjand Stengaard
;
; AmigaDOS script to detect valid amiga os 3.1.4 modules floppy disk or adf file.

set modulesmodel ""
set modulesvalid "0"

; goto check modules, if volume name is "ModulesA500_3.1.4:"
IF "`Which $amigaosdisk:`" EQ "ModulesA500_3.1.4:"
  set modulesmodel "A500"
  SKIP checkmodules
ENDIF

; goto check modules, if volume name is "ModulesA600_3.1.4:"
IF "`Which $amigaosdisk:`" EQ "ModulesA600_3.1.4:"
  set modulesmodel "A600"
  SKIP checkmodules
ENDIF

; goto check modules, if volume name is "ModulesA1200_3.1.4:"
IF "`Which $amigaosdisk:`" EQ "ModulesA1200_3.1.4:"
  set modulesmodel "A1200"
  SKIP checkmodules
ENDIF

; goto check modules, if volume name is "ModulesA2000_3.1.4:"
IF "`Which $amigaosdisk:`" EQ "ModulesA2000_3.1.4:"
  set modulesmodel "A2000"
  SKIP checkmodules
ENDIF

; goto check modules, if volume name is "ModulesA3000_3.1.4:"
IF "`Which $amigaosdisk:`" EQ "ModulesA3000_3.1.4:"
  set modulesmodel "A3000"
  SKIP checkmodules
ENDIF

; goto check modules, if volume name is "ModulesA4000D_3.1.4:"
IF "`Which $amigaosdisk:`" EQ "ModulesA4000D_3.1.4:"
  set modulesmodel "A4000D"
  SKIP checkmodules
ENDIF

; goto check modules, if volume name is "ModulesA4000T_3.1.4:"
IF "`Which $amigaosdisk:`" EQ "ModulesA4000T_3.1.4:"
  set modulesmodel "A4000T"
  SKIP checkmodules
ENDIF

SKIP end


; check modules
; -------------

LAB checkmodules

; check scsi device, if devs modules model exist
IF EXISTS "$amigaosdisk:DEVS/$modulesmodel"
  ; end, if scsi device doesn't exist
  IF NOT EXISTS "$amigaosdisk:DEVS/$modulesmodel/scsi.device"
    SKIP end
  ENDIF

  ; end, if scsi device is greater than v45.7
  Version >NIL: "$amigaosdisk:DEVS/$modulesmodel/scsi.device" 45 8 FILE
  IF $RC EQ 0 VAL
    SKIP end
  ENDIF

  ; end, if scsi device is less than v45.7
  Version >NIL: "$amigaosdisk:DEVS/$modulesmodel/scsi.device" 45 6 FILE
  IF NOT $RC EQ 0 VAL
    SKIP end
  ENDIF
ENDIF

set modulesvalid "1"


; end
; ---

LAB end
