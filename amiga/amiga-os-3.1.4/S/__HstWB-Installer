; HstWB Installer
; ---------------
;
; Date: 2018-10-13
; Author: Henrik Noerfjand Stengaard


; Clear screen
cls

; fail, if installdir: doesn't exist
Assign >NIL: EXISTS INSTALLDIR:
IF NOT $RC EQ 0 VAL
  echo ""
  echo "*e[1mERROR: INSTALLDIR: doesn't exist!*e[22m"
  SKIP fail
ENDIF 

; test assigns
Assign >NIL: SYSTEMDIR: DH0:

; test install amiga os 3.1.4 from disk
;execute INSTALLDIR:S/Install-Amiga-OS-3.1.4-Disk
;SKIP end

; fail, if amigaosdir: doesn't exist
Assign >NIL: EXISTS AMIGAOSDIR:
IF NOT $RC EQ 0 VAL
  echo ""
  echo "*e[1mERROR: AMIGAOSDIR: doesn't exist!*e[22m"
  SKIP fail
ENDIF 

; detect amiga os 3.9 in AMIGAOSDIR:
;Execute "INSTALLDIR:S/Amiga-OS-3.9/Detect-Amiga-OS-3.9"

; detect amiga os 3.1.4 in AMIGAOSDIR:
Execute "INSTALLDIR:S/Amiga-OS-3.1.4/Detect-Amiga-OS-3.1.4-Adf"

; detect amiga os 3.1 in AMIGAOSDIR:
;Execute "INSTALLDIR:S/Amiga-OS-3.1/Detect-Amiga-OS-3.1-Adf"


; install amiga os 3.9
IF EXISTS "INSTALLDIR:Prefs/Install-Amiga-OS-3.9"
  ; ask user to install amiga os 3.1 first
  set installamigaos31 `RequestChoice "Install Amiga OS 3.1" "Do you want to install Amiga OS 3.1*Nbefore installing Amiga OS 3.9?" "Yes|No"` 
  IF "$installamigaos31" EQ 1 VAL
    IF EXISTS "INSTALLDIR:Prefs/Install-Amiga-OS-3.1-Adf"
      ; run install amiga os 3.1 adf
    ELSE
      ; run install amiga os 3.1 disk
    ENDIF
  ENDIF

  ; run install amiga os 3.9.0
  SKIP complete
ENDIF

; install amiga os 3.1.4
IF EXISTS "INSTALLDIR:Prefs/Install-Amiga-OS-3.1.4-Adf"
  ; run install amiga os 3.1.4 adf
  Execute "INSTALLDIR:S/Amiga-OS-3.1.4/Install-Amiga-OS-3.1.4-Adf"

  SKIP complete
ENDIF

; install amiga os from disk
echo "install amiga os from disk"
SKIP end





; amiga os 3.1.4
; --------------

; goto amiga os 3.1 adf, if copy amiga os 3.1.4 adf script doesn't exist
IF NOT EXISTS "HSTWBINSTALLER:S/Amiga-OS-3.1.4/Copy-Amiga-OS-3.1.4-Adf"
  SKIP amigaos31adf
ENDIF

; create amiga os 3.1.4 installdir temp directory, if it doesn't exist
IF NOT EXISTS "HSTWBINSTALLER:Temp/Amiga-OS-314/"
  MakePath >NIL: "HSTWBINSTALLER:Temp/Amiga-OS-314"
ENDIF

; copy amiga os 3.1.4 adf files to installdir temp directory
List AMIGAOSDIR: PAT=#? ALL FILES LFORMAT "Execute HSTWBINSTALLER:S/Amiga-OS-3.1.4/Copy-Amiga-OS-3.1.4-Adf *"%p%n*" *"HSTWBINSTALLER:Temp/Amiga-OS-314*" WORKBENCH" >T:_copy_amiga-os-3.1.4_adfs
Execute T:_copy_amiga-os-3.1.4_adfs
Delete >NIL: T:_copy_amiga-os-3.1.4_adfs

; skip to amiga os 3.1 adf, if amiga os 3.1.4 workbench adf doesn't exist
IF NOT EXISTS "HSTWBINSTALLER:Temp/Amiga-OS-314/amiga-os-314-workbench.adf"
  SKIP amigaos31adf
ENDIF

; extract amiga os 3.1.4 workbench adf
MakeDir >NIL: "HSTWBINSTALLER:Temp/Amiga-OS-314/amiga-os-314-workbench"
xadUnFile >NIL: "HSTWBINSTALLER:Temp/Amiga-OS-314/amiga-os-314-workbench.adf" "HSTWBINSTALLER:Temp/Amiga-OS-314/amiga-os-314-workbench" DIMG OVERWRITE

; load system files from amiga os 3.1.4 workbench adf
set systemfilesdir "HSTWBINSTALLER:Temp/Amiga-OS-314/amiga-os-314-workbench/C"
SKIP loadsystemfiles


; amiga os 3.1
; ------------
LAB amigaos31adf

; goto generic, if copy amiga os 3.1 adf script doesn't exist
IF NOT EXISTS "HSTWBINSTALLER:S/Amiga-OS-3.1/Copy-Amiga-OS-3.1-Adf"
  SKIP amigaosdisk
ENDIF

; create amiga os 3.1 installdir temp directory, if it doesn't exist
IF NOT EXISTS "HSTWBINSTALLER:Temp/Amiga-OS-310/"
  MakePath >NIL: "HSTWBINSTALLER:Temp/Amiga-OS-310"
ENDIF

; copy amiga os 3.1 adf files to installdir temp directory
List AMIGAOSDIR: PAT=#? ALL FILES LFORMAT "Execute HSTWBINSTALLER:S/Amiga-OS-3.1/Copy-Amiga-OS-3.1-Adf *"%p%n*" *"HSTWBINSTALLER:Temp/Amiga-OS-310*" WORKBENCH" >T:_copy_amiga-os-3.1_adfs
Execute T:_copy_amiga-os-3.1_adfs
Delete >NIL: T:_copy_amiga-os-3.1_adfs

; goto generic, if amiga os 3.1 workbench adf doesn't exist
IF NOT EXISTS "HSTWBINSTALLER:Temp/Amiga-OS-310/amiga-os-310-workbench.adf"
  SKIP generic
ENDIF

; extract amiga os 3.1 workbench adf
MakeDir >NIL: "HSTWBINSTALLER:Temp/Amiga-OS-310/amiga-os-310-workbench"
xadUnFile >NIL: "HSTWBINSTALLER:Temp/Amiga-OS-310/amiga-os-310-workbench.adf" "HSTWBINSTALLER:Temp/Amiga-OS-310/amiga-os-310-workbench" DIMG OVERWRITE

; load system files from amiga os 3.1 workbench adf
set systemfilesdir "HSTWBINSTALLER:Temp/Amiga-OS-310/amiga-os-310-workbench/C"
SKIP loadsystemfiles







; complete
; --------

LAB complete
echo ""
echo "Complete"

SKIP end


; fail
; ----

LAB fail
echo ""
echo "Installation failed."
quit


; end
; ---
LAB end
