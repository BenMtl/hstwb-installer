; Startup Sequence
; ------------------------------------
;
; Date: 2018-10-11
; Author: Henrik Noerfjand Stengaard


FailAt 21

; Load patched scsi.device v43.45, if it exists
IF EXISTS DEVS:scsi.device
  ; Load scsi.device, if current loaded scsi.device is less than v43.45
  Version >NIL: "scsi.device" 43 45
  IF WARN
    LoadModule DEVS:scsi.device
  ENDIF
ENDIF


; Add alias
Alias cls "Echo NOLINE *"*E[0;0H*E[J*" " 


; Startup message
cls 
echo "*e[32m" NOLINE
echo "HstWB Installer v1.3.0-ALPHA"
echo "*e[0m*e[1m" NOLINE
echo "----------------------------"
echo "*e[0m" NOLINE
echo ""
echo "HstWB Installer is now running install."

; Set stack
stack 16384


; Load system files
; -----------------
LAB loadsystemfiles

; Load basic commands resident
echo ""
echo "*e[1mLoading Workbench system files from Workbench 3.1.4 disk...*e[0m"
"DF0:C/AddBuffers" >NIL: DF0: 200
resident "DF0:C/Assign" PURE
resident "DF0:C/Copy" PURE
resident "DF0:C/Delete" PURE
resident "DF0:C/Eval" PURE
resident "DF0:C/Execute" PURE
resident "DF0:C/List" PURE
resident "DF0:C/Rename" PURE
resident "DF0:C/MakeDir" PURE
resident "DF0:C/Protect" PURE
resident "DF0:C/Search" PURE 
resident "DF0:C/Wait" PURE 
resident "DF0:C/Which" PURE 
resident "DF0:C/Mount" PURE
resident "DF0:C/Type" PURE
resident "DF0:C/RequestChoice" PURE
resident "DF0:C/Version" PURE
ENDIF
echo "Done"
echo ""
ask "Press ENTER to continue"


MakeDir RAM:Clipboards RAM:ENV RAM:ENV/Sys
Assign ENV: RAM:Env
Assign T: RAM:
SetEnv TZ MST7


; fail, if installdir: doesn't exist
Assign >NIL: EXISTS INSTALLDIR:
IF NOT $RC EQ 0 VAL
  echo ""
  echo "*e[1mERROR: INSTALLDIR: doesn't exist!*e[22m"
  SKIP fail
ENDIF 

; test assigns
Assign >NIL: SYSTEMDIR: DH0:

; test install amiga os 3.1.4 from disk
;execute INSTALLDIR:S/Install-Amiga-OS-3.1.4-Disk
;SKIP end

; fail, if amigaosdir: doesn't exist
Assign >NIL: EXISTS AMIGAOSDIR:
IF NOT $RC EQ 0 VAL
  echo ""
  echo "*e[1mERROR: AMIGAOSDIR: doesn't exist!*e[22m"
  SKIP fail
ENDIF 

; detect amiga os 3.9 in AMIGAOSDIR:
;Execute "INSTALLDIR:S/Amiga-OS-3.9/Detect-Amiga-OS-3.9"

; detect amiga os 3.1.4 in AMIGAOSDIR:
Execute "INSTALLDIR:S/Amiga-OS-3.1.4/Detect-Amiga-OS-3.1.4-Adf"

; detect amiga os 3.1 in AMIGAOSDIR:
;Execute "INSTALLDIR:S/Amiga-OS-3.1/Detect-Amiga-OS-3.1-Adf"


; install amiga os 3.9
IF EXISTS "INSTALLDIR:Prefs/Install-Amiga-OS-3.9"
  ; ask user to install amiga os 3.1 first
  set installamigaos31 `RequestChoice "Install Amiga OS 3.1" "Do you want to install Amiga OS 3.1*Nbefore installing Amiga OS 3.9?" "Yes|No"` 
  IF "$installamigaos31" EQ 1 VAL
    IF EXISTS "INSTALLDIR:Prefs/Install-Amiga-OS-3.1-Adf"
      ; run install amiga os 3.1 adf
    ELSE
      ; run install amiga os 3.1 disk
    ENDIF
  ENDIF

  ; run install amiga os 3.9.0
  SKIP complete
ENDIF

; install amiga os 3.1.4
IF EXISTS "INSTALLDIR:Prefs/Install-Amiga-OS-3.1.4-Adf"
  ; run install amiga os 3.1.4 adf
  Execute "INSTALLDIR:S/Amiga-OS-3.1/Install-Amiga-OS-3.1.4-Adf"

  SKIP complete
ENDIF

; install amiga os from disk
echo "install amiga os from disk"
SKIP end


; complete
; --------

LAB complete
echo ""
echo "Complete"

SKIP end


; fail
; ----

LAB fail
echo ""
echo "Installation failed."
quit


; end
; ---
LAB end
